<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/account_layout}"
      layout:fragment="Content">
  <head>
    <meta charset="UTF-8" />
    <title>계약등록</title>
	<style>
 /* 버튼 그룹 기본 설정 */
  .btn-group {
    display: flex;
    gap: 5px; /* 버튼 간 간격 */
    font-size: 18px;
    margin-bottom: 10px;
  }

  /* 버튼 그룹 왼쪽 */
  .btn-group.left {
    justify-content: flex-start; /* 왼쪽 정렬 */
  }

  /* 버튼 그룹 오른쪽 */
  .btn-group.right {
    justify-content: flex-end; /* 오른쪽 정렬 */
  }

  /* 그리드 위 영역 */
  .grid-controls {
    display: flex;
    justify-content: space-between; /* 양쪽 끝으로 버튼 그룹 배치 */
    align-items: center;
    margin-top:50px;
    
  }
  .tui-grid-summary-area .tui-grid-cell, tui-grid-cell-content {
    text-align: right;
}
	</style>
  </head>
  <body>
   <!-- 페이지 컨테이너 -->
    <div class="container-fluid p-4">
      <form>
      
      <!-- 계약일자, 거래처 -->
        <div class="row mb-3">
        <!-- 계약일자 -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="contract-date">계약일자</label>
              <input type="date" class="form-control" id="contract-date" />
            </div>
          </div>
          <!-- 거래처 -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="client">거래처</label>
              <div class="input-group">
                <!-- 거래처 입력 필드-->
                <input type="text" class="form-control" id="client" placeholder="거래처" readonly />
                <!-- 거래처 선택 모달 호출 버튼 -->
                <button type="button" class="btn btn-outline-secondary select-modal" data-bs-target="#client-modal">
                  <i class="lucide-search h-4 w-4"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        
		<!-- 계약코드, 계약명 -->
        <div class="row mb-3">
        <!-- 계약코드 -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="contract-code">계약코드</label>
              <!-- 자동 생성된 계약 코드 표시, 읽기 전용 -->
              <input type="text" class="form-control" id="contract-code" value="00005" readonly />
            </div>
          </div>
          <!-- 계약명 -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="contract-name">계약명</label>
              <input type="text" class="form-control" id="contract-name" placeholder="계약명" />
            </div>
          </div>
        </div>
        
		<!-- 계약시작일, 계약종료일 -->
        <div class="row mb-3">
        <!-- 계약시작일 -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="billing-start-date">계약시작일</label>
              <input type="date" class="form-control" id="billing-start-date" />
            </div>
          </div>
          <!-- 계약종료일 -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="billing-end-date">계약종료일</label>
              <input type="date" class="form-control" id="billing-end-date" />
            </div>
          </div>
        </div>
        
		<!-- 부가세유형, 계약상태 -->
        <div class="row mb-3">
        <!-- 부가세 유형 -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="vat-type">부가세유형</label>
              <select class="form-select" id="vat-type">
                <option>세금계산서</option>
              </select>
            </div>
          </div>
          <!-- 계약 상태 -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="status">계약상태</label>
               <!-- 계약 상태 선택 -->
              <select class="form-select" id="status">
                <option>진행</option>
                <option>종료</option>
                <option>보류</option>
              </select>
            </div>
          </div>
        </div>

		<!-- 담당자, 부서 -->
        <div class="row mb-3">
        <!-- 담당자 -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="manager">담당자</label>
              <div class="input-group">
               <!-- 담당자 필드-->
                <input type="text" class="form-control" id="manager" placeholder="담당자" readonly />
                <!-- 담당자 선택 모달 호출 버튼 -->
                <button type="button" class="btn btn-outline-secondary select-modal" data-bs-target="#manager-modal">
                  <i class="lucide-search h-4 w-4"></i>
                </button>
              </div>
            </div>
          </div>
          <!-- 부서 -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="department">부서</label>
              <div class="input-group">
              <!-- 부서 필드-->
                <input type="text" class="form-control" id="department" placeholder="부서" readonly />
                <!-- 부서 선택 모달 호출 버튼 -->
                <button type="button" class="btn btn-outline-secondary select-modal" data-bs-target="#department-modal">
                  <i class="lucide-search h-4 w-4"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
		
		<!-- 적요 -->
        <div class="row mb-3">
          <div class="col-md-8">
            <div class="form-group">
              <label for="description">적요</label>
              <!-- 적요 입력 필드 -->
              <input type="text" class="form-control" id="description" placeholder="적요" />
            </div>
          </div>
        </div>

		<!-- 첨부 -->
        <div class="row mb-3">
          <div class="col-md-8">
            <div class="form-group">
              <label for="attachment">첨부</label>
              <div class="input-group">
              <!-- 첨부파일 업로드 -->
                <input type="file" id="attachment-file" class="form-control" />
              </div>
            </div>
          </div>
        </div>
        <div class="grid-controls">
        
		<!-- 버튼 그룹 (그리드 위 왼쪽) -->
      <div class="btn-group left">
        <button type="button" class="btn btn-success" id="add-item-btn">+ 항목 추가</button>
        <button type="button" class="btn btn-danger" id="delete-item-btn">- 선택 삭제</button>
      </div>
       
       
       <!-- 버튼 그룹 (그리드 위 오른쪽) -->
      <div class="btn-group rigth">
        <button type="button" class="btn btn-success" id="save-btn">저장</button>
        <button type="button" class="btn btn-secondary">다시 작성</button>
        <!-- 리스트로 이동하는 버튼 -->
        <button type="button" class="btn btn-secondary">리스트</button>
      </div>


  </div>
  	<!-- 그리드 -->
	<div id="grid"></div>
        
    
        
        </form>
        </div> <!-- 페이지 컨테이너 끝 -->
      
      

    <!-- 모달/거래처 -->
    <div class="modal fade" id="client-modal" tabindex="-1" aria-labelledby="clientModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="clientModalLabel">거래처 선택</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ul>
              <li><button class="btn btn-link" onclick="setClientValue('거래처1')">거래처1</button></li>
              <li><button class="btn btn-link" onclick="setClientValue('거래처2')">거래처2</button></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- 모달/담당자 -->
    <div class="modal fade" id="manager-modal" tabindex="-1" aria-labelledby="managerModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="managerModalLabel">담당자 선택</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ul>
              <li><button class="btn btn-link" onclick="setManagerValue('담당자1')">담당자1</button></li>
              <li><button class="btn btn-link" onclick="setManagerValue('담당자2')">담당자2</button></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- 모달/부서 -->
    <div class="modal fade" id="department-modal" tabindex="-1" aria-labelledby="departmentModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="departmentModalLabel">부서 선택</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ul>
              <li><button class="btn btn-link" onclick="setDepartmentValue('부서1')">부서1</button></li>
              <li><button class="btn btn-link" onclick="setDepartmentValue('부서2')">부서2</button></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
	
	<script th:src='@{/js/index/toast.js}'></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
    	  
    	  // 그리드 데이터
    	  const gridData = [
    		  {
    		    itemName: '',        // 품목
    		    unitPrice: 0,        // 단가
    		    supplyAmount: 0,     // 공급가액
    		    vat: 0,              // 부가세
    		    totalAmount: 0,      // 총 금액
    		  },
    		  {
      		    itemName: '',        // 품목
      		    unitPrice: 0,        // 단가
      		    supplyAmount: 0,     // 공급가액
      		    vat: 0,              // 부가세
      		    totalAmount: 0,      // 총 금액
      		  },
    		  {
      		    itemName: '',        // 품목
      		    unitPrice: 0,        // 단가
      		    supplyAmount: 0,     // 공급가액
      		    vat: 0,              // 부가세
      		    totalAmount: 0,      // 총 금액
      		  },
    		];
    	  

		 
    	  // 그리드 초기화
    	  const grid = new tui.Grid({
    	    el: document.querySelector('#grid'),  // 그리드 표시 위치
    	    data: gridData,  // 초기 데이터
    	    scrollX: true,   // 가로 스크롤 사용
    	    scrollY: true,   // 세로 스크롤 사용
    	    columns: [
    	      {
    	        header: '품목',
    	        name: 'itemName',
    	        editor: 'text',
    	        align: 'left',
    	      },
    	      {
    	        header: '단가',
    	        name: 'unitPrice',
    	        editor: {
    	        	type:gridNumber
    	        },
    	        align: 'right',
    	      },
    	      {
    	        header: '공급가액',
    	        name: 'supplyAmount',
    	        editor: {
    	        	type:gridNumber
    	        },
    	        align: 'right',
 
    	      },
    	      {
    	        header: '부가세',
    	        name: 'vat',
    	        editor: {
    	        	type:gridNumber
    	        },
    	        align: 'right',

    	      },
    	      {
    	        header: '총 금액',
    	        name: 'totalAmount',
    	        editor: {
    	        	type:gridNumber
    	        },
    	        align: 'right',
 
    	      },
    	    ], 
    	    summary: {
    	        height: 40,
    	        position: 'bottom', // or 'top'
    	        columnContent: {
    	        	unitPrice: {
    	            template: function(valueMap) {
    	              return `${valueMap.sum}`;
    	            }
    	          },
    	          supplyAmount: {
    	            template: function(valueMap) {
    	              return `${valueMap.sum}`;
    	            }
    	          },
  	        	vat: {
    	            template: function(valueMap) {
    	              return `${valueMap.sum}`;
    	            }
    	          },
    	          totalAmount: {
    	            template: function(valueMap) {
    	              return `${valueMap.sum}`;
    	            }
    	          },
    	          itemName: {
      	            template: function(valueMap) {
      	              return `합계`;
      	            }
      	          },
    	          
    	        }
    	      },
    	
    	    rowHeaders: ['rowNum', 'checkbox'], // 행 번호와 체크박스 표시
    	  });


    	  // 그리드 클릭 이벤트 -> 추후 내가 필요한대로 수정
    	  grid.on('click', (event) => {
    	    if (event.columnName === 'debentureNo' && event.rowKey >= 0) {
    	      console.log('클릭이벤트 발생');
    	      console.log(event.rowKey);  // 클릭한 행의 키 값 출력
    	    }
    	  });

        // 모달 띄우기
        document.querySelectorAll(".select-modal").forEach(function (btn) {
          btn.addEventListener("click", function () {
            const modalId = btn.getAttribute("data-bs-target").substring(1);
            const modal = new bootstrap.Modal(document.getElementById(modalId));
            modal.show();
          });
        });

        // 첨부파일 처리(파일 선택 시 이름 표시)
        document.getElementById("attachment-file").addEventListener("change", function (event) {
          document.getElementById("attachment").value = event.target.files[0].name;
        });
      });
    </script>
  </body>
</html>
